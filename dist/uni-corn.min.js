!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Store=e()}}(function(){return function e(t,n,r){function i(o,a){if(!n[o]){if(!t[o]){var u="function"==typeof require&&require;if(!a&&u)return u(o,!0);if(s)return s(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return i(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function s(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!s(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,s,u,f;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(n=this._events[e],a(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(o(n))for(s=Array.prototype.slice.call(arguments,1),f=n.slice(),r=f.length,u=0;u<r;u++)f[u].apply(this,s);return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(n=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},r.prototype.removeListener=function(e,t){var n,r,s,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],s=n.length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(a=s;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){r=a;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],i(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){var n=this,r=t.eventName||n.storeId,i={};fetch(e,t).then(function(e){return i.status=e.status,i.ok=e.ok,/application\/json/.test(e.headers.get("content-type"))?e.json():e.text()}).then(function(e){if(!i.ok)throw e;t.propName?n.actions.set(t.propName,e):(u["default"].update(r,e),"function"==typeof t.onSuccess&&t.onSuccess(e))})["catch"](function(e){u["default"].update(t.errorEvent,e)})}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("./updater"),u=r(a),f=function(){function e(t,n){if(i(this,e),!t)throw new Error("Store constructor expects name as first argument");var r=this;this.storeName=t,this.props=n||{},this.storeId=(Date.now()+Math.ceil(6474*Math.random())).toString(16),this.fetchActions={},this.forms={},this.inputs={},this.actions={get:function(e){var t=r.props[e],n=r.storeName+"-"+e;if(!t)try{t=JSON.parse(localStorage.getItem(n))}catch(i){t=localStorage.getItem(n)}if(!t)try{t=JSON.parse(sessionStorage.getItem(n))}catch(i){t=localStorage.getItem(n)}return t},getAll:function(){return r.props},set:function(e,t){var n=arguments.length<=2||void 0===arguments[2]||arguments[2],i=arguments[3];r.props[e]=t;var s=r.storeName+"-"+e;i===!0?localStorage.setItem(s,t):"session"===i&&(localStorage.removeItem(s),sessionStorage.setItem(s,t)),n===!0&&u["default"].update(r.storeId,e)}},this.get=this.actions.get,this.set=this.actions.set,this.getAll=this.actions.getAll}return o(e,[{key:"addErrorCallback",value:function(e){u["default"].register(this.storeId+"-error",e)}},{key:"addCallback",value:function(e){u["default"].register(this.storeId,e)}},{key:"subscribe",value:function(e){u["default"].register(this.storeId,e)}},{key:"unsubscribe",value:function(e){u["default"].unsubscribe(this.storeId,e)}},{key:"addAction",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]||arguments[2],r=this;return"function"!=typeof t?console.error("Store addAction expects a function as the second argument"):void(this.actions[e]=function(){for(var e=arguments.length,i=Array(e),s=0;s<e;s++)i[s]=arguments[s];t.apply(r,i),n===!0&&u["default"].update(r.storeId)})}},{key:"addInput",value:function(e){var t=this,n=this;this.inputs[e]={onChange:function(r){t.inputs[e].value=r.target.value,u["default"].update(n.storeId,e)},value:""}}},{key:"getInitalFormState",value:function(e){var t={};return e.forEach(function(e){t[e]={value:"",error:null,onChange:function(e){}}}),{fields:t,onSubmit:function(e){}}}},{key:"addForm",value:function(e){var t=this,n=this;Array.isArray(e.fields)||window.console.error("addForm requires an array of fields names as it's second agument");var r=n.storeId;this.forms[e.name]={getForm:function(){return{fields:this.fields,onSubmit:this.onSubmit}},fields:{},onSubmit:function(i){i.preventDefault();var s={},a=!1;return Object.keys(t.forms[e.name].fields).forEach(function(n){var r=t.forms[e.name].fields;r[n].required&&!r[n].value?(t.forms[e.name].fields[n].error="The "+n+" field is required",a=!0):t.forms[e.name].fields[n].error=null,s[n]=r[n].value}),a===!0?u["default"].update(r,e.name):void n.fetchActions[o]({body:s})}},e.fields.forEach(function(i){t.forms[e.name].fields[i.name]={value:"undefined"==typeof i["default"]?null:i["default"],required:i.required||!1,error:null,onChange:function(t){var s=t.target.value;"checkbox"===t.target.type&&(s=t.target.checked),n.forms[e.name].fields[i.name].value=s,u["default"].update(r,i)}}}),"function"==typeof e.onUpdate&&(r=n.storeId+"-form",u["default"].register(r,e.onUpdate),u["default"].register(r+"-error",e.onUpdate));var i=r+"-form-error";"function"==typeof e.errorCallback&&(u["default"].register(r,e.onUpdate),u["default"].register(i,e.errorCallback));var s=function(t,n){u["default"].unregister(r),e.onSuccess(n),this.forms[t]={}}.bind(this,e.name),o=e.name+"-form";n.addFetchAction(o,{url:e.url,method:"post",eventName:r,errorEvent:i,onSuccess:s})}},{key:"addFetchAction",value:function(e,t){var n=this;t.method.toUpperCase();n.fetchActions[e]=function(e){function r(e,t){return t?(Object.keys(t).forEach(function(n){e=e.replace(n,t[n])}),e):e}var i={method:t.method||"GET",headers:{"Content-Type":"application/json"},eventName:t.eventName||n.storeId,errorEvent:t.errorEvent||n.storeId+"-error",credentials:"same-origin",onSuccess:t.onSuccess};e&&e.body&&(i.body=JSON.stringify(e.body));var o=e&&e.urlArgs,a=r(t.url,o);s.call(n,a,i)}}}]),e}();n["default"]=f},{"./updater":3}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("events"),i=function(){var e=new r.EventEmitter,t={"default":[]},n=function(e){delete t[e]},i=function(n,r){var i="default";"function"==typeof n?r=n:"string"==typeof n&&(i=n),"undefined"==typeof t[i]&&(t[i]=new Set),t[i].add(r),t[i].forEach(function(t){e.on(i,t)})},s=function(n,r){t[n]["delete"](r),e.removeListener(n,r)},o=function(){t["default"].forEach(function(e){e()})};e.on("update",o);var a=function(t,n){t||(t="update"),e.emit(t,n)};return{register:i,unregister:n,unsubscribe:s,update:a}}();n["default"]=i},{events:1}]},{},[2])(2)});